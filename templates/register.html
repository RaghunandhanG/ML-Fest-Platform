{% extends "base.html" %}
{% block title %}Register - Team Qernels CTF{% endblock %}
{% block extra_css %}
<style>
.auth-wrap { max-width: 420px; margin: 2rem auto; position: relative; }
.auth-shadow { position: absolute; inset: 0; background: var(--border-dark); border-radius: var(--radius-lg); transform: translate(8px, 8px); }
.auth-inner { position: relative; z-index: 2; background: var(--bg-card); border: var(--border-w) solid var(--border-dark); border-radius: var(--radius-lg); padding: 2rem 2rem; }
.auth-inner h1 { font-size: 1.6rem; font-weight: 800; letter-spacing: -0.02em; margin-bottom: 0.25rem; }
.auth-sub { color: var(--text-muted); font-size: 0.88rem; margin-bottom: 1.75rem; }
.auth-form .btn-primary { width: 100%; padding: 0.75rem; font-size: 0.95rem; margin-top: 0.25rem; }
.auth-footer { text-align: center; margin-top: 1.25rem; font-size: 0.85rem; color: var(--text-muted); }
.auth-footer a { color: var(--red); font-weight: 700; text-decoration: none; }
.auth-footer a:hover { text-decoration: underline; }
.pw-reqs { background: var(--bg-input); border: 2px solid var(--border-dark); border-radius: var(--radius); padding: 0.65rem 0.9rem; margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-muted); display: flex; flex-wrap: wrap; gap: 0.4rem 1rem; font-weight: 600; }
.req { display: flex; align-items: center; gap: 0.3rem; }
.req-icon { font-size: 0.75rem; transition: color 0.15s; }
.req-icon.ok { color: var(--green); }
.req-icon.fail { color: var(--text-muted); }
</style>
{% endblock %}
{% block content %}
<div class="auth-wrap">
    <div class="auth-shadow"></div>
    <div class="auth-inner">
        <h1>Create account</h1>
        <p class="auth-sub">Join the ML Fest and start capturing flags.</p>
        <form class="auth-form" id="registerForm">
            <div class="form-group"><label>Username</label><input type="text" id="username" required placeholder="At least 3 characters" autocomplete="username"></div>
            <div class="form-group"><label>Email</label><input type="email" id="email" required placeholder="you@example.com" autocomplete="email"></div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="password" required placeholder="Create a strong password" autocomplete="new-password">
                <div class="pw-reqs" id="pwReqs">
                    <span class="req"><span class="req-icon fail" id="r-len">&#9675;</span> 8+ chars</span>
                    <span class="req"><span class="req-icon fail" id="r-upper">&#9675;</span> Uppercase</span>
                    <span class="req"><span class="req-icon fail" id="r-num">&#9675;</span> Number</span>
                </div>
            </div>
            <div class="form-group"><label>Confirm Password</label><input type="password" id="confirm" required placeholder="Repeat password" autocomplete="new-password"></div>
            <div id="regMsg"></div>
            <button type="submit" class="btn btn-primary" id="submitBtn" disabled>Create Account</button>
        </form>
        <div class="auth-footer">Already have an account? <a href="{{ url_for('auth.login') }}">Sign in</a></div>
    </div>
</div>
<script>
const pw = document.getElementById('password');
const cf = document.getElementById('confirm');
const btn = document.getElementById('submitBtn');
function check(id, ok) { var el = document.getElementById(id); el.innerHTML = ok ? '&#9679;' : '&#9675;'; el.className = 'req-icon ' + (ok ? 'ok' : 'fail'); }
function validate() { var v = pw.value; var lenOk = v.length >= 8; var upOk = /[A-Z]/.test(v); var numOk = /[0-9]/.test(v); check('r-len', lenOk); check('r-upper', upOk); check('r-num', numOk); btn.disabled = !(lenOk && upOk && numOk && v && v === cf.value); }
pw.addEventListener('input', validate); cf.addEventListener('input', validate);
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault(); var msg = document.getElementById('regMsg'); msg.innerHTML = '';
    try {
        var res = await fetch('/auth/register', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: document.getElementById('username').value, email: document.getElementById('email').value, password: pw.value }) });
        var data = await res.json();
        if (data.success) { msg.innerHTML = '<div class="alert alert-success" style="margin-bottom:0.75rem;">' + data.message + '</div>'; setTimeout(function() { window.location.href = '/auth/login'; }, 2500); }
        else { msg.innerHTML = '<div class="alert alert-error" style="margin-bottom:0.75rem;">' + data.message + '</div>'; }
    } catch (err) { msg.innerHTML = '<div class="alert alert-error" style="margin-bottom:0.75rem;">Registration failed. Please try again.</div>'; }
});
</script>
{% endblock %}